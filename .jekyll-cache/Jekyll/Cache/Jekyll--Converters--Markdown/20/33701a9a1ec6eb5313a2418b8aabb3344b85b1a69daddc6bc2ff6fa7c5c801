I"É%<blockquote>
  <p><strong>The information provided in this site is for educational purposes regarding pentesting. The author of the site will not be held any responsibility for any misuse of the information from this site.</strong></p>
</blockquote>

<h2 id="summary"><strong><span style="color:#ff5555">Summary</span></strong></h2>
<hr />
<ul>
  <li>Modify the cookie to get <code class="language-plaintext highlighter-rouge">ssh key</code> from the <code class="language-plaintext highlighter-rouge">/admin</code></li>
  <li>Crack the <code class="language-plaintext highlighter-rouge">ssh key</code> with john</li>
  <li><code class="language-plaintext highlighter-rouge">Ssh</code> as <strong>James</strong></li>
  <li>Modify the <code class="language-plaintext highlighter-rouge">/etc/hosts</code> to our <code class="language-plaintext highlighter-rouge">tun0</code> ip</li>
  <li>Create the same directory in our machine <code class="language-plaintext highlighter-rouge">/downloads/src</code></li>
  <li>Create the script with the same name which is <code class="language-plaintext highlighter-rouge">buildscript.sh</code> as reverse shell</li>
  <li>Start the listener, and <code class="language-plaintext highlighter-rouge">Root</code></li>
</ul>

<h2 id="port-scan"><strong><span style="color:#ff5555">Port scan</span></strong></h2>
<hr />

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/nmapX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>From the nmap scan, we found 2 ports are open, <code class="language-plaintext highlighter-rouge">22</code> as ssh and <code class="language-plaintext highlighter-rouge">80</code> that running golang http server.</p>

<p>While running <code class="language-plaintext highlighter-rouge">Gobuster</code>, We check the website on browser and found nothing interesting from it.</p>

<h2 id="check-the-website"><strong><span style="color:#ff5555">Check the website</span></strong></h2>
<hr />

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/websiteX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<h2 id="gobuster"><strong><span style="color:#ff5555">Gobuster</span></strong></h2>
<hr />

<p>Looking at the result from <code class="language-plaintext highlighter-rouge">Gobuster</code>, it shows <code class="language-plaintext highlighter-rouge">/admin</code> directory, so lets check that out.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/gobusterX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<h2 id="bypass-the-admin-directory"><strong><span style="color:#ff5555">Bypass the admin directory</span></strong></h2>
<hr />

<p>It redirects us to <code class="language-plaintext highlighter-rouge">login</code> form which I tried to perform <strong>SQL injection</strong> and failed.</p>

<p>By looking at the <code class="language-plaintext highlighter-rouge">source code</code> and click the <code class="language-plaintext highlighter-rouge">javascript</code> code that brings us to function which has a simple if else statements, its checking for a cookie that called SessionToken, so I figured it out just by creating a cookie and give any random value, we will get something from the page.</p>

<p>So we press <code class="language-plaintext highlighter-rouge">ctrl+shift+i</code> and add the <code class="language-plaintext highlighter-rouge">name</code> as Session Token.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/source1X.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/source2X.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>By refreshing the page, it shows us the private ssh keys of <strong>James</strong>.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/gotkeyX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<h2 id="cracking-the-hash"><strong><span style="color:#ff5555">Cracking the hash</span></strong></h2>
<hr />

<p>Add it as a new file, we can call the file with any names, and <code class="language-plaintext highlighter-rouge">chmod 600</code> the file otherwise it won‚Äôt work when we <code class="language-plaintext highlighter-rouge">ssh</code> into the machine.</p>

<p>It shows the potential user is <code class="language-plaintext highlighter-rouge">James</code>, we fire up <code class="language-plaintext highlighter-rouge">ss2john.py</code> and make it to hash that john can read in order to crack it, we also can use hashcat.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/johncrackX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<h2 id="get-in-as-user"><strong><span style="color:#ff5555">Get in as user</span></strong></h2>
<hr />

<p>So we try to get in as <code class="language-plaintext highlighter-rouge">James</code> and now we can read <code class="language-plaintext highlighter-rouge">user.txt</code>.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/usertxtX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>Also there is <code class="language-plaintext highlighter-rouge">todo.txt</code>, so lets cat it out.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/todotxtX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<h2 id="privilege-escalation-to-root"><strong><span style="color:#ff5555">Privilege Escalation to root</span></strong></h2>
<hr />

<p>After looking around, I decided to just run <code class="language-plaintext highlighter-rouge">linpeas</code> and let‚Äôs see what happens after that.</p>

<p>We send <code class="language-plaintext highlighter-rouge">linpeas</code> from our machine</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/pythonsendlinpeasX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>And we download the linpeas as <code class="language-plaintext highlighter-rouge">James</code></p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/downloadlinpeasX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>From the linpeas‚Äôs result, we found there is crontab that execute the particular script.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/crontab1X.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/crontab2X.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>And surprisingly we have access to write <code class="language-plaintext highlighter-rouge">/etc/hosts</code> which usually only <code class="language-plaintext highlighter-rouge">root</code> user is able to do that.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/hostcanwriteX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<h2 id="quick-brief"><strong><span style="color:#ff5555">Quick Brief</span></strong></h2>
<hr />

<p>Let me <strong>explain</strong> how this is going to work,</p>

<p>We can see the crontab is executing a particular script which leads to <code class="language-plaintext highlighter-rouge">overpass.thm/downloads/src/buildscript.sh</code>, and we are able to modify the <code class="language-plaintext highlighter-rouge">/etc/hosts</code> and change <code class="language-plaintext highlighter-rouge">overpass.thm</code> to our <code class="language-plaintext highlighter-rouge">tun0</code> ip which let the machine downloads the file from our machine and execute.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/etchostsmodifX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>So here after modified the <code class="language-plaintext highlighter-rouge">/etc/hosts</code>, we need to create the same directory as shows on the crontab.</p>

<p>And we can do anything with the file, <code class="language-plaintext highlighter-rouge">SUID Hijack</code>, <code class="language-plaintext highlighter-rouge">Reverse Shell</code>, <code class="language-plaintext highlighter-rouge">Cat the root.txt</code> etc.</p>

<p>I put my python reverse shell in the <code class="language-plaintext highlighter-rouge">buildscript.sh</code>.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/pyscriptrevshellX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>We need to start python server from our machine in order to let the machine download our fake <code class="language-plaintext highlighter-rouge">buildscript.sh</code></p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/pythonserverX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<p>And also start the listener with <code class="language-plaintext highlighter-rouge">netcat</code>.</p>

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/thm/overpass/rootX.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<hr />

<table>
  <tbody>
    <tr>
      <td>![]({{ ‚Äú/images/mandatory/pwned.png‚Äù</td>
      <td>relative_url }})</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><a href="https://tryhackme.com/room/overpass">Overpass - Tryhackme</a></p>
</blockquote>

:ET