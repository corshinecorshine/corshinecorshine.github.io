I"p<blockquote>
  <p><strong>The information provided in this site is for educational purposes regarding pentesting. The author of the site will not be held any responsibility for any misuse of the information from this site.</strong></p>
</blockquote>

<h2 id="summary"><strong><span style="color:#ff5555">Summary</span></strong></h2>
<hr />
<ul>
  <li>Download <strong>username.txt</strong> and <strong>password.txt</strong> from the room page.</li>
  <li>Enumerate the kerberos with <strong>kerbrute</strong>.</li>
  <li>Getting hash and crack with <strong>hashcat</strong>.</li>
  <li>Get in with <strong>smbclient</strong> to get <code class="language-plaintext highlighter-rouge">backup_credentials.txt</code>.</li>
  <li>Crack the bash with <strong>base64</strong>.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">secretsdump.py</code> to dump credentials from <strong>backup@spookysec.local</strong>.</li>
  <li>Get in as <strong>Administrator</strong> with NTLM hash.</li>
</ul>

<h2 id="port-scan"><strong><span style="color:#ff5555">Port scan</span></strong></h2>
<hr />

<p>Run nmap is helpful to gather information about the target.</p>

<p><img src="/images/thm/attacktive-directory/nmap.png" alt="" /></p>

<p>Found DNS of the target is <code class="language-plaintext highlighter-rouge">spookysec.local</code>, add it to <strong>/etc/hosts</strong>, it’s a good practice to add the target machine into our <strong>/etc/hosts</strong>.</p>

<h2 id="check-the-website"><strong><span style="color:#ff5555">Check the website</span></strong></h2>
<hr />

<p><img src="/images/thm/attacktive-directory/website.png" alt="" /></p>

<p>I’m not going to look around because I hate <strong>windows</strong>’s interface.</p>

<p>By seeing nmap’s result, there are port that used for <code class="language-plaintext highlighter-rouge">Active Directory</code> which is <strong>389</strong>.</p>

<h2 id="enumeration"><strong><span style="color:#ff5555">Enumeration</span></strong></h2>
<hr />

<p>I ran <strong>enum4linux</strong> with <strong>-a</strong> flag for simple enumeration against the target to get list of users, machines, group &amp; member list, sharelist, etc.</p>

<p><img src="/images/thm/attacktive-directory/enum4linux.png" alt="" /></p>

<p>The username and password were given by the author of the room, no idea why.</p>

<p>I only need the potential username and I need to bruteforce the kerberos with <strong>kerbrute</strong> to get usernames.</p>

<h2 id="bruteforce-kerberos"><strong><span style="color:#ff5555">Bruteforce Kerberos</span></strong></h2>
<hr />

<blockquote>
  <p>Get the kerberos <a href="https://github.com/ropnop/kerbrute">here</a></p>
</blockquote>

<p>So I ran <strong>kerbrute</strong> to get potential real users in order to proceed to the next steps.</p>

<p><img src="/images/thm/attacktive-directory/kerbrute2.png" alt="" /></p>

<p>Next step is to get the password or bash for the user and with <code class="language-plaintext highlighter-rouge">GetPNUsers.py</code> from <strong>Impacket</strong>.</p>

<p><img src="/images/thm/attacktive-directory/gethash.png" alt="" /></p>

<h2 id="cracking"><strong><span style="color:#ff5555">Cracking</span></strong></h2>
<hr />

<p>Decided to decrypt it with <strong>hashcat</strong>, and got the cracked password to login with <strong>smb</strong>. <code class="language-plaintext highlighter-rouge">John</code> also can be used but I prefer <strong>hashcat</strong> because it quicker than john IMO.</p>

<p><img src="/images/thm/attacktive-directory/hashcat.png" alt="" /></p>

<p>After getting the credentials of svc-admin, I decided to check shared file as <code class="language-plaintext highlighter-rouge">svc-admin</code></p>

<h2 id="smbclient"><strong><span style="color:#ff5555">Smbclient</span></strong></h2>
<hr />

<p>There are multiple <strong>sharename</strong> and I selected one of those which <strong>backup</strong>.</p>

<p><img src="/images/thm/attacktive-directory/smbclient1.png" alt="" /></p>

<p>It turns out someone put <code class="language-plaintext highlighter-rouge">backup_credentials.txt</code> inside, and I can download it to my machine and read it.</p>

<p><img src="/images/thm/attacktive-directory/getbackupcreds.png" alt="" /></p>

<p>The file was encoded with base64, so I decrypt it immediately on  in order to get the password of the user.</p>

<p><img src="/images/thm/attacktive-directory/base64crack.png" alt="" /></p>

<h2 id="escalating-to-administrator"><strong><span style="color:#ff5555">Escalating to Administrator</span></strong></h2>
<hr />

<p>Now I have username and password, I decided to get <strong>Administrator</strong>’s hash with <code class="language-plaintext highlighter-rouge">secretsdump.py</code>, also from <strong>impacket</strong></p>

<p><img src="/images/thm/attacktive-directory/secretsdump.png" alt="" /></p>

<p>As of now I have the NTLM hash of the <strong>Administrator</strong>, I can just login with <code class="language-plaintext highlighter-rouge">evil-winrm</code>. and read the flag.</p>

<p><img src="/images/thm/attacktive-directory/roottxt.png" alt="" /></p>

<hr />

<p><img src="/images/mandatory/pwned.png" alt="" /></p>
:ET